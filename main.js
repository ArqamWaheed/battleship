(()=>{"use strict";function t(t){const e=document.querySelector(t),i=e.querySelector(".grid");for(let t=0;t<11;t++)for(let e=0;e<11;e++){const r=document.createElement("div");r.className="grid-cell",0===t&&0===e?r.classList.add("header-cell"):0===t?(r.classList.add("header-cell"),r.textContent=String.fromCharCode(64+e)):0===e?(r.classList.add("header-cell"),r.textContent=t.toString()):(r.dataset.row=t-1,r.dataset.col=e-1),i.appendChild(r)}e.appendChild(i)}const e=function(){let t,e,i,r,n={},s="miss";const a=function(t,e){n[t]&&n[t].forEach(i=>{try{i(e)}catch(e){console.error(`Error in ${t} observer:`,e)}})},o=function(){return{currentTurn:t,winner:r}};function c(){return s}return{subscribe:function(t,e){n[t]||(n[t]=[]),n[t].push(e)},unsubscribe:function(t,e){n[t]&&(n[t]=n[t].filter(t=>t!==e))},notify:a,getCurrentTurn:function(){return t},getState:o,switchTurn:function(){t=t===e?i:e,a("turnSwitched",o())},attackInitiated:function(e,i){a("attackInitiated",{currentTurn:t,coordinates:e,shipName:i,GetTurnAttack:c})},SetTurnAttack:function(t){s=t},GetTurnAttack:c,setCurrentTurn:function(e){t=e},initialize:function(n,s){e=n,i=s,r=null,t=n},checkGameEnd:function(){return e.checkAllShipsSunk()?(r=i,a("endGame",o()),!0):!!i.checkAllShipsSunk()&&(r=e,a("endGame",o()),!0)}}}();function i(t){let e=0;return{hit:function(){e++},isSunk:function(){return e>=t},getHitsReceived:function(){return e},getLength:function(){return t}}}class r{constructor(t){this.instanceName=t,this.aircraft={...i(5),name:"aircraft"},this.battleship={...i(4),name:"battleship"},this.cruiser={...i(3),name:"cruiser"},this.destroyer1={...i(2),name:"destroyer1"},this.destroyer2={...i(2),name:"destroyer2"},this.submarine1={...i(1),name:"submarine1"},this.submarine2={...i(1),name:"submarine2"},this.board=this.#t(),this.playableMoves=this.#e(),this.missedShots=[]}resetGameboard=()=>{this.aircraft={...i(5),name:"aircraft"},this.battleship={...i(4),name:"battleship"},this.cruiser={...i(3),name:"cruiser"},this.destroyer1={...i(2),name:"destroyer1"},this.destroyer2={...i(2),name:"destroyer2"},this.submarine1={...i(1),name:"submarine1"},this.submarine2={...i(1),name:"submarine2"},this.board=this.#t(),this.playableMoves=this.#e(),this.missedShots=[]};#t(){const t=[];for(let e=0;e<10;e++)t[e]=Array(10).fill(null);return t}#e(){const t=[];for(let e=0;e<10;e++)for(let i=0;i<10;i++)t.push([e,i]);return t}placeShip(t,e,i){const[r,n]=e,[s,a]=i;if(this.#i(r,n),!this.#r(r,n)||!this.#r(s,a))throw Error("Spot already occupied");if(this.board[r][n]=t,r-s!==0)for(let e=1;e<Math.abs(r-s)+1;e++)this.board[Math.min(r,s)+e][n]=t;if(n-a!==0)for(let e=1;e<Math.abs(n-a)+1;e++)this.board[r][Math.min(n,a)+e]=t;this.board[s][a]=t}#i(t,e){if(t>9||e>9||t<0||e<0)throw Error("Out Of Bounds")}#r(t,e){return null===this.board[t][e]}receiveAttack=t=>{if(t.currentTurn.instanceName.toString()!==this.instanceName){const[i,r]=t.coordinates;this.#i(i,r);const n=this.missedShots.some(([t,e])=>t===i&&e===r);if(this.#r(i,r)||n){if(n)throw Error("Coordinate already attacked");return this.missedShots.push(t.coordinates),void e.SetTurnAttack("miss")}return this.board[i][r].hit(),void e.SetTurnAttack("hit")}};checkAllShipsSunk(){return this.aircraft.isSunk()&&this.battleship.isSunk()&&this.cruiser.isSunk()&&this.destroyer1.isSunk()&&this.destroyer2.isSunk()&&this.submarine1.isSunk()&&this.submarine2.isSunk()}randomizeShipPlacement(){const t=[{ship:this.aircraft,length:5},{ship:this.battleship,length:4},{ship:this.cruiser,length:3},{ship:this.destroyer1,length:2},{ship:this.destroyer2,length:2},{ship:this.submarine1,length:1},{ship:this.submarine2,length:1}];for(const{ship:e,length:i}of t){let t=!1;for(;!t;){const r=Math.random()<.5,n=Math.floor(10*Math.random()),s=Math.floor(10*Math.random());let a=n,o=s;if(r?a=n+(i-1):o=s+(i-1),a<10&&o<10)try{let c=!0;if(r)for(let t=0;t<i;t++){if(!this.#r(n+t,s)){c=!1;break}for(let e=-1;e<=1;e++){for(let i=-1;i<=1;i++){if(0===e&&0===i)continue;const r=n+t+e,a=s+i;if(r>=0&&r<10&&a>=0&&a<10&&!this.#r(r,a)){c=!1;break}}if(!c)break}if(!c)break}else for(let t=0;t<i;t++){if(!this.#r(n,s+t)){c=!1;break}for(let e=-1;e<=1;e++){for(let i=-1;i<=1;i++){if(0===e&&0===i)continue;const r=n+e,a=s+t+i;if(r>=0&&r<10&&a>=0&&a<10&&!this.#r(r,a)){c=!1;break}}if(!c)break}if(!c)break}c&&(this.placeShip(e,[n,s],[a,o]),t=!0)}catch(t){continue}}}}}const n=new r("Player"),s=new r("Computer");e.initialize(n,s),n.randomizeShipPlacement(),s.randomizeShipPlacement();const a=document.querySelector(".board1"),o=document.querySelector(".board2"),c=document.querySelector(".board1 .grid"),u=document.querySelector(".board2 .grid"),d=document.querySelector("#computer-status-grid"),l=document.querySelector("#player-status-grid"),h=document.querySelector("#game-end-modal"),m=document.querySelector("#restart-button"),f=document.querySelector("#modal-message");function b(t){h.classList.toggle("show"),function(t){f.textContent=`The winner is ${t}!`}(t)}function p(){for(const t in n.board)for(const e in n.board)null!==n.board[t][e]&&c.querySelector(`[data-row="${t}"][data-col="${e}"]`).classList.add("ship")}function y(t,e){const[i,r]=t;return e.board[i][r]?.name?e.board[i][r].name:null}u.addEventListener("click",function(t){if(e.getCurrentTurn()==n&&(i=t.target).classList.contains("grid-cell")&&!i.classList.contains("header-cell")&&!i.classList.contains("hit")&&!i.classList.contains("miss")){const i=function(t){return[parseInt(t.dataset.row,10),parseInt(t.dataset.col,10)]}(t.target),r=y(i,s);e.attackInitiated(i,r),0==e.checkGameEnd()&&(e.switchTurn(),async function(){const t=function(){const t=Math.floor(Math.random()*s.playableMoves.length);return s.playableMoves.splice(t,1)[0]}(),i=y(t,n);await new Promise(t=>setTimeout(t,500)),e.attackInitiated(t,i),0==e.checkGameEnd()&&e.switchTurn()}())}var i}),m.addEventListener("click",()=>{b()}),e.subscribe("turnSwitched",function(t){t.currentTurn===n?(a.style.opacity=.5,o.style.opacity=1):(a.style.opacity=1,o.style.opacity=.5)}),e.subscribe("attackInitiated",n.receiveAttack),e.subscribe("attackInitiated",s.receiveAttack),e.subscribe("attackInitiated",function(t){const[e,i]=t.coordinates,r=t.currentTurn===n?u:c,s=t.currentTurn===n?d:l;r.querySelector(`[data-row="${e}"][data-col="${i}"]`).classList.add(t.GetTurnAttack()),null!==t.shipName&&s.querySelector(`[data-ship="${t.shipName}"] .ship-block:not(.hit)`).classList.add("hit")}),e.subscribe("endGame",s.resetGameboard),e.subscribe("endGame",n.resetGameboard),e.subscribe("endGame",function(e){b(e.winner.instanceName),document.querySelectorAll(".ship-block.hit").forEach(t=>t.classList.remove("hit")),u.replaceChildren(),c.replaceChildren(),t(".board1"),t(".board2"),n.randomizeShipPlacement(),s.randomizeShipPlacement(),p()}),e.subscribe("endGame",()=>e.initialize(n,s)),document.addEventListener("DOMContentLoaded",()=>{t(".board1"),t(".board2"),p()})})();
//# sourceMappingURL=main.js.map